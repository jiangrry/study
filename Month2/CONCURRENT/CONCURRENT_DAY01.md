[TOC]

# 1. 进程基础认知

## 1.1 多任务编程

>   在此之前我们学习编写程序的运行都由一个执行序列组成，执行序列按顺序在主机的中央处理器（CPU）中运行。
>
>   无论是任务本身要求顺序执行还是整个程序是由多个子任务组成，程序都是按这种方式执行的。即使子任务相互独立，互相无关（即一个子任务的结果不影响其它子任务的结果）时也是这样。
>
>   这样是不是有点不合逻辑？会不会想要并行运行这些相互独立的子任务呢？这样的并行处理可以大幅度地提升整个任务的效率。这就是多任务编程的目的。
>
>   多任务编程对于某些任务来说，是最理想的。这些任务具有以下特点：
>
>   它们本质上就是异步的，需要有多个并发事务，各个事务的运行顺序可以是不确定的，随机的，不可预测的。这样的编程任务可以被分成多个执行流，每个流都有一个要完成的目标。根据应用的不同，这些子任务可能都要计算出一个中间结果，用于合并得到最后的结果。运算密集型的任务一般都比较容易分隔成多个子任务，可以顺序执行或以多任务的方式执行。
>
>   把这种编程任务用多线程来组织可以降低程序的复杂度，并使得干净，有效和具有良好组织地程序结构实现变得可能。

## 1.2 进程概述

>   多进程和多线程是实现多任务编程的主要手段。这里先对进程进行讲解。
>
>   计算机程序只不过是磁盘中可执行的，二进制（或其它类型）的数据。它们只有在被读取到内存中，被操作系统调用的时候才开始它们的生命期。进程（有时被称为重量级进程）是程序的一次执行。每个进程都有自己的地址空间，内存，数据栈以及其它记录其运行轨迹的辅助数据（在linux系统下记录在PCB当中）。操作系统管理在其上运行的所有进程，并为这些进程公平地分配时间。在进程中存在父子进程的关系。

## 1.3 进程和程序

程序 ： 是一个可执行文件，是静态的，占有磁盘，不占计算机的运行资源。

定义： 程序在计算机中的一次执行过程。

-   程序是一个可执行的文件，是静态的占有磁盘。

-   进程是一个动态的过程描述，占有计算机运行资源，有一定的生命周期。

    ![](./img/19.jpg)

注意：同一个程序的不同运行过程是不同的进程。因为分配的计算机资源不同，生命周期也不同。

## 1.4 进程特征

-   动态性 
    动态性是进程的最基本特征，它是程序执行过程，它是有一定的生命期。它由创建而产生、由调度而执行，因得不到资源而暂停，并由撤消而死亡。而程序是静态的，它是存放在介质上一组有序指令的集合，无运动的含义。

-   并发性 
    并发性是进程的重要特征，同时也是OS的重要特征。并发性指多个进程实体同存于内存中，能在一段时间内同时运行。而程序是不能并发执行。
-   独立性 
    进程是一个能独立运行的基本单位，即是一个独立获得资源和独立调度的单位，而程序不作为独立单位参加运行。
-   异步性：进程按各自独立的不可预知的速度向前推进，即进程按异步方式进行，正是这一特征，将导致程序执行的不可再现性，因此OS必须采用某种措施来限制各进程推进序列以保证各程序间正常协调运行。
-   结构特征：从结构上，进程实体由程序段、数据段和进程控制块三部分组成，UNIX中称为“进程映象”。

## 1.5 产生进程

![](./img/产生过程.png)

## 1.6 进程概念

进程控制块(PCB)通常是系统内存占用区中的一个连续存区，它存放着操作系统用于描述进程情况及控制进程运行所需的全部信息。

进程控制块(PCB):

1.  进程的标识符pid, name;
2.  进程的调度信息：进程的状态， 进程的优先级，进程的关系;
3.  进程控制信息 ：资源清单，信号量， 互斥量， 锁的信息，虚拟的地址
4.  处理机的信息：通用寄存器，指令计数器等

cpu时间片，即CPU分配给各个程序的时间，每个线程被分配一个时间段，称作它的时间片，即该进程允许运行的时间，使各个程序从表面上看是同时进行的。如果在时间片结束时进程还在运行，则CPU将被剥夺并分配给另一个进程。如果进程在时间片结束前阻塞或结束，则CPU当即进行切换。而不会造成CPU资源浪费。在宏观上：我们可以同时打开多个应用程序，每个程序并行不悖，同时运行。但在微观上：由于只有一个CPU，一次只能处理程序要求的一部分，如何处理公平，一种方法就是引入时间片，每个程序轮流执行。

父子进程，在系统中除了初始化进程每个进程都有一个父进程，可能有0个或者多个子进程。由此形成进程的父子关系。父子进程方便进程的管理和创建。

# 2. 进程状态和进程命令

## 2.1 进程的三个状态

-   运行态/执行态(Running)：当一个进程在处理机上运行时，则称该进程处理运行状态。
-   就绪态(Ready)：一个进程获得了除处理机外的一切所需资源，一旦得到处理即可运行，则称此进程处于就绪状态。
-   阻塞态(Blocked)(又称挂起状态、等待状态)：一个进程正在等待某一事件发生(例如请求 I / O 而等待 I / O完成等)而暂时停止运行，这时即使把处理分配给进程也无法运行，故称该进程处于阻塞状态。

## 2.2 进程状态之间的转换

|        |        | 说明                                                         |
| ------ | ------ | ------------------------------------------------------------ |
| 就绪态 | 运行态 | 当处理空闲时，进程调度程序必将处理机分配给一个处于就绪态的进程，该进程便由就绪态转换为运行态。 |
| 运行态 | 阻塞态 | 处于运行态的进程在运行过程中需要等待某一事件发生后(例如因 I / O 而请求等待 I / O完成后)，才能继续运行，则该进程放弃处理机，从运行态转换为阻塞态度。 |
| 阻塞态 | 就绪态 | 处于阻塞的过程，若其等待的事件已经发生，于是进程由阻塞态转换为就绪态。 |
| 运行态 | 就绪态 | 处于运行状态的进程在其运行的过程中，因分给它的处理机时间片已用完，而不得不给出(被强占)处理机，于是进程由运行态转为就绪态 |

-   而阻塞态 --> 运行态和就绪态 --> 阻塞态这两种态度转换不可能发生。

## 2.3 进程状态图

### 2.3.1 三态图

进程在生命周期中也会有不同的状态，最常见的三态图：

-   就绪态 ： 进程具备执行条件，等待系统调度分配cpu资源

-   运行态 ： 进程占有cpu正在运行

-   等待态 ： 进程阻塞等待，此时会让出cpu

![img](./img/4_3%E6%80%81.png)

### 2.3.2 进程五态

五态 (在三态基础上增加新建和终止)

-   新建 ： 创建一个进程，获取资源的过程

-   终止 ： 进程结束，释放资源的过程

![img](./img/4_5%E6%80%81.png)

## 2.4 进程的命令

-   `ps` 是 `linux ` 中最基本的浏览系统中进程的命令。能列出系统中运行的进程，包括进程、命令、CPU使用量、内存使用量等；

    ```bash
    ps -ef | grep : 列出需要进程
    ps -aux : 显示进程信息，包括无终端的(x) 和 针对用户的(x)的进程。
    ```

    ![img](./img/20.png)

    -   USER ： 进程的创建者
    -   PID : 操作系统分配给进程的编号,大于0的整数，系统中每个进程的PID都不重复。PID也是重要的区分进程的标志。
    -   %CPU,%MEM : 占有的CPU和内存
    -   STAT ： 进程状态信息，S I 表示阻塞状态 ，R 表示就绪状态或者运行状态
    -   START : 进程启动时间
    -   COMMAND : 通过什么程序启动的进程 

-   `top` 命令：实时监控系统的状态

-   `kill` 命令：

    ```
    kill -9 PID 强行杀死进程
    kill -15 PID 正常结束
    killall 进程名称 
    ```
