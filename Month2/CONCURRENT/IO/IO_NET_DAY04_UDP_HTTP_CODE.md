[TOC]

# 1. UDP套接字编程

## 1.1 UDP服务端编程

### 1.1.1 UDP 服务端套接字编程流程

![](./img/UDP服务器端编程.png)

### 1.1.2 UDP 套接字函数

>   注意不能选择默认值了，默认值是`tcp`套接字。

-   创建套接字

```
sockfd=socket.socket(socket_family,socket_type,proto=0)
功能：创建套接字
参数：socket_family  网络地址类型 AF_INET表示ipv4
     socket_type  套接字类型 SOCK_DGRAM 表示udp套接字 （也叫数据报套接字） 
     proto  通常为0  选择子协议
返回值： 套接字对象
```

>   绑定地址和我们的`tcp` 套接字一致。

-   绑定地址

```python
sockfd.bind(addr)
功能： 绑定本机网络地址
参数： 二元元组 (ip,port)  ('0.0.0.0',8888)
```

-   消息收发

```
data,addr = sockfd.recvfrom(buffersize)
功能： 接收UDP消息
参数： 每次最多接收多少字节
返回值： data  接收到的内容
        addr  消息发送方地址

n = sockfd.sendto(data,addr)
功能： 发送UDP消息
参数： data  发送的内容 bytes格式
      addr  目标地址
返回值：发送的字节数
```

-   关闭套接字

```
sockfd.close()
功能：关闭套接字
```

### 1.1.3 UDP 服务端编程

```python
"""
    udp 套接字 服务端流程
"""

from socket import *

# 1. 创建套接字
#  第一个参数： ipv4 ； 第二个参数： UDP编程 --> 不能选择默认
sockfd = socket(AF_INET, SOCK_DGRAM)

# 2. 绑定地址
server_addr = ("127.0.0.1", 8888)
sockfd.bind(server_addr)

# 3. 循环收发消息
while True:
    try:
        data, addr = sockfd.recvfrom(1024)
    except KeyboardInterrupt:
        break
    print("From clinet %s ,Msg: %s" % (addr, data.decode()))
    sockfd.sendto(b'Thanks', addr)

# 4. 关闭套接字
sockfd.close()
```

## 1.2 UDP 客户端编程

### 1.2.1 UDP 客户端套接字编程流程

![](./img/UDP客户端编码.png)

### 1.2.2 UDP 客户端编码

```PYTHON
"""
    udp 套接字 客户端编程流程
"""
from socket import *

# 1. 创建套接字
sockfd = socket(AF_INET, SOCK_DGRAM)  # 不能使用默认

ADDR = ("127.0.0.1", 8888)

# 2. 循环收发消息
while True:
    msg = input("Msg>>> ")
    if not msg:
        break
    sockfd.sendto(msg.encode(), ADDR)
    data, addr = sockfd.recvfrom(1024)
    print("Response: ", data.decode())

# 3. 关闭套接字
sockfd.close()

```

## 1.3 UDP 客户端 和 服务端流程

![](./img/11.png)

## 1.4 UDP 套接字特点

-   可能会出现数据丢失的情况
-   传输过程简单，实现容易
-   数据以数据包形式表达传输
-   数据传输效率较高

## 1.5 案例：查找单词

```python
从客户端使用 input 输入一个单词，发送给服务端。服务端基于单词本找到该单词，将单词和单词解释挥发给客户端，由客户端打印出来。
```

##  1.6 TCP 和 UDP 编程对比

-   传输特征
    -   `TCP`提供可靠的数据传输，但是`UDP`则不保证传输的可靠性
    
    -   `TCP`传输数据处理为字节流，而`UDP`处理为数据包形式
    
    -   `TCP`传输需要建立连接才能进行数据传，效率相对较低，`UDP`比较自由，无需连接，效率较高
    
-   套接字编程区别
    -   创建的套接字类型不同
    -   `tcp`套接字会有粘包，`udp`套接字有消息边界不会粘包
    -   `tcp`套接字依赖`listen accept`建立连接才能收发消息，`udp`套接字则不需要
    -   `tcp`套接字使用`send，recv`收发消息，`udp`套接字使用`sendto，recvfrom`
-   使用场景
    -   `tcp`更适合对准确性要求高，传输数据较大的场景
        -   文件传输：如下载电影，访问网页，上传照片
        -   邮件收发
        -   点对点数据传输：如点对点聊天，登录请求，远程访问，发红包
    -   `udp`更适合对可靠性要求没有那么高，传输方式比较自由的场景
        -   视频流的传输： 如直播，视频聊天
        -   广播：如网络广播，群发消息
        -   实时传输：如游戏画面
    -   在一个大型的项目中，可能既涉及到`TCP`网络又有`UDP`网络

# 2. HTTP 协议

## 2.1 HTTP 协议简介

超文本传输协议（HTTP，HyperText Transfer Protocol)是互联网上应用最为广泛的一种网络协议。所有的`WWW`文件都必须遵守这个标准。设计HTTP最初的目的是为了提供一种发布和接收HTML页面的方法。1960年美国人Ted Nelson构思了一种通过计算机处理文本信息的方法，并称之为超文本（hypertext）,这成为了HTTP超文本传输协议标准架构的发展根基。Ted Nelson组织协调万维网协会（World Wide Web Consortium）和互联网工程工作小组（Internet Engineering Task Force ）共同合作研究，最终发布了一系列的RFC，其中著名的RFC 2616定义了HTTP 1.1。

## 2.2 HTTP 协议特点

<img src=".\img\HTTP 请求与响应.png" style="zoom:75%;" />

-   用途 ： 网页获取，数据的传输
-   特点
    -   支持 客户/服务端模式；
    -   简单快速：客户向服务器发起请求时，只需传递请求方法和路径。
    -   灵活：`HTTP` 允许传输任意类型的数据对象。正在传输的类型为`Content-Type` 加以标记；
    -   无状态：`HTTp` 协议是无状态协议，无状态是指：协议对于事务处理没有记忆功能；
    -   无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。

## 2.3 HTTP 请求 Request

![](./img/请求体.png)

### 2.3.1 HTTP 请求格式

-   请求行： 具体的请求类别和请求内容

-   请求头：对请求的进一步解释和描述，对请求解释说明

-   空行

-   请求体: 请求参数或者提交内容

### 2.3.2 请求行和请求类型

-   请求行 ： 具体的请求类别和请求内容、协议版本

```
GET         /        HTTP/1.1
请求类别   请求内容     协议版本
```

-   请求类别：每个请求类别表示要做不同的事情
-   八种方法或者叫做“动作” 来表明对 `Request-URL` 指定的资源的不同操作方式，我们也可以称之为请求类型。

```
请求类型：
OPTIONS：返回服务器针对特定资源所支持的HTTP请求方法，也可以利用向web服务器发送‘*’的请求来测试服务器的功能性

HEAD：向服务器索与GET请求相一致的响应，只不过响应体将不会被返回。这一方法可以再不必传输整个响应内容的情况下，就可以获取包含在响应小消息头中的元信息。

GET：向特定的资源发出请求。注意：GET方法不应当被用于产生“副作用”的操作中，例如在Web Application中，其中一个原因是GET可能会被网络蜘蛛等随意访问。Loadrunner中对应get请求函数：web_link和web_url

POST：向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST请求可能会导致新的资源的建立和/或已有资源的修改。

PUT：向指定资源位置上传其最新内容

DELETE：请求服务器删除Request-URL所标识的资源

TRACE：回显服务器收到的请求，主要用于测试或诊断

CONNECT：HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器。
```

### 2.3.3 请求头

-   请求头：对请求新的的具体描述。以键值对的格式对信息进行具体描述。

![](./img/请求头.png)

### 2.3.4 请求体

-   请求参数或者提交内容

```PYTHON
"""
    http 测试
        tcp 服务器端
    查看 http 请求内容
        请求行
        请求头
        空行
        请求体 # 因为没有内容, 所以显示空行
"""

from socket import *

s = socket()
s.bind(("127.0.0.1", 8888))
s.listen(3)
c, addr = s.accept()

print("Connect From", addr)
data = c.recv(2048)
print(data.decode())

c.close()
s.close()
```

## 2.4 HTTP 响应

### 2.4.1 HTTP 响应格式

-   响应行 ： 反馈具体的响应情况。

-   响应头 ： 对响应的具体描述，以键值对方式给出响应信息的具体描述。

-   空行

-   响应体 ： 将客户想要的内容进行返回。比如一个网页文件，一组数据，一张图片等。

### 2.4.2 HTTP 响应行和响应码

-   响应行 ： 反馈基本的响应情况

```
HTTP/1.1     200       OK
版本信息    响应码   附加信息
```

### 2.4.3 HTTP 常见响应码

-   响应码分为 5 类：

```
1xx  提示信息，表示请求被接收
2xx  响应成功
3xx  响应需要进一步操作，重定向
4xx  客户端错误
5xx  服务器错误
```

#### 1xx: 信息

| 消息：                  | 描述：                                                       |
| ----------------------- | :----------------------------------------------------------- |
| 100 Continue            | 服务器仅接收到部分请求，但是一旦服务器并没有拒绝该请求，客户端应该继续发送其余的请求。 |
| 101 Switching Protocols | 服务器转换协议：服务器将遵从客户的请求转换到另外一种协议。   |
| 103 Checkpoint          | 用于 PUT 或者 POST 请求恢复失败时的恢复请求建议。            |

#### 2xx: 成功

| 消息：                            | 描述：                                                       |
| --------------------------------- | ------------------------------------------------------------ |
| 200 OK                            | 请求成功（这是对HTTP请求成功的标准应答。）                   |
| 201 Created                       | 请求被创建完成，同时新的资源被创建。                         |
| 202 Accepted                      | 供处理的请求已被接受，但是处理未完成。                       |
| 203 Non-Authoritative Information | 请求已经被成功处理，但是一些应答头可能不正确，因为使用的是其他文档的拷贝。 |
| 204 No Content                    | 请求已经被成功处理，但是没有返回新文档。浏览器应该继续显示原来的文档。如果用户定期地刷新页面，而Servlet可以确定用户文档足够新，这个状态代码是很有用的。 |
| 205 Reset Content                 | 请求已经被成功处理，但是没有返回新文档。但浏览器应该重置它所显示的内容。用来强制浏览器清除表单输入内容。 |
| 206 Partial Content               | 客户发送了一个带有Range头的GET请求，服务器完成了它。         |

#### 3xx: 重定向

| 消息：                 | 描述：                                                       |
| ---------------------- | ------------------------------------------------------------ |
| 300 Multiple Choices   | 多重选择。服务器根据请求可执行多种操作。服务器可根据 请求者 来选择一项操作，或提供操作列表供其功能。 |
| 301 Moved Permanently  | 永久移动，所请求的页面已经转移至新的 URL 。服务器返回此响应是，会自动将请求者转移到新位置。您应使用此代码通知搜索蜘蛛网页或网站已被永久移动到新的位置。 |
| 302 Found              | 所请求的页面已经临时转移至新的 URL 。                        |
| 303 See Other          | 所请求的页面可在别的 URL 下被找到。                          |
| 304 Not Modified       | 未按预期修改文档。客户端有缓冲的文档并发出了一个条件性的请求（一般是提供If-Modified-Since头表示客户只想比指定日期更新的文档）。服务器告诉客户，原来缓冲的文档还可以继续使用。 |
| 305 Use Proxy          | 客户请求的文档应该通过Location头所指明的代理服务器提取。     |
| 306 Switch Proxy       | *目前已不再使用，但是代码依然被保留。*                       |
| 307 Temporary Redirect | 被请求的页面已经临时移至新的 URL 。                          |
| 308 Resume Incomplete  | 用于 PUT 或者 POST 请求恢复失败时的恢复请求建议。            |

#### 4xx: 客户端错误

| 消息：                              | 描述：                                                       |
| ----------------------------------- | ------------------------------------------------------------ |
| 400 Bad Request                     | 因为语法错误，服务器未能理解请求，可能是请求格式错误。       |
| 401 Unauthorized                    | 合法请求，但对被请求页面的访问被禁止。因为被请求的页面需要身份验证，客户端没有提供或者身份验证失败。 |
| 402 Payment Required                | *此代码尚无法使用。*                                         |
| 403 Forbidden                       | 合法请求，但对被请求页面的访问被禁止。                       |
| 404 Not Found                       | 服务器无法找到被请求的页面。                                 |
| 405 Method Not Allowed              | 请求中指定的方法不被允许。                                   |
| 406 Not Acceptable                  | 服务器生成的响应无法被客户端所接受。                         |
| 407 Proxy Authentication Required   | 用户必须首先使用代理服务器进行验证，这样请求才会被处理。     |
| 408 Request Timeout                 | 请求超出了服务器的等待时间。                                 |
| 409 Conflict                        | 由于冲突，请求无法被完成。                                   |
| 410 Gone                            | 被请求的页面不可用。                                         |
| 411 Length Required                 | "Content-Length" 未被定义。如果无此内容，服务器不会接受请求。 |
| 412 Precondition Failed             | 请求中的前提条件被服务器评估为失败。                         |
| 413 Request Entity Too Large        | 由于所请求的实体太大，服务器不会接受请求。                   |
| 414 Request-URI Too Long            | 由于 URL 太长，服务器不会接受请求。当 POST 请求被转换为带有很长的查询信息的 GET 请求时，就会发生这种情况。 |
| 415 Unsupported Media Type          | 由于媒介类型不被支持，服务器不会接受请求。                   |
| 416 Requested Range Not Satisfiable | 客户端请求部分文档，但是服务器不能提供被请求的部分。         |
| 417 Expectation Failed              | 服务器不能满足客户在请求中指定的请求头。                     |

#### 5xx: 服务器错误

| 消息：                              | 描述：                                                       |
| ----------------------------------- | ------------------------------------------------------------ |
| 500 Internal Server Error           | 请求未完成。服务器遇到不可预知的情况。                       |
| 501 Not Implemented                 | 请求未完成。服务器不支持所请求的功能，或者服务器无法完成请求。 |
| 502 Bad Gateway                     | 请求未完成。服务器充当网关或者代理的角色时，从上游服务器收到一个无效的响应。 |
| 503 Service Unavailable             | 服务器当前不可用（过载或者当机）。                           |
| 504 Gateway Timeout                 | 网关超时。服务器充当网关或者代理的角色时，未能从上游服务器收到一个及时的响应。 |
| 505 HTTP Version Not Supported      | 服务器不支持请求中指明的HTTP协议版本。                       |
| 511 Network Authentication Required | 用户需要提供身份验证来获取网络访问入口。                     |

### 2.4.4 响应头

-   响应头：对响应内容的描述，以健值对方式给出相应信息的具体描述

```
Content-Type: text/html;charset=utf-8
Content-Length:109\r\n
```

### 2.4.5 响应体

-   响应体：响应正文，服务端返回给客户端的文本信息。

![](./img/响应体.png)

## 2.5 案例： 主页访问

```python
编写一个基于 http 协议的服务端程序。通过浏览器向服务端发起主页访问请求，获取主页并显示出来。注意是一个 html 文件，可以使用提供的 index.html 文件作为主页。
```
