# IO_NET_DAY02

[TOC]

## 1. 网络编程

### 1.1 网络基础知识

#### 1.1.1 什么是网络

* 什么是网络 : 计算机网络功能主要包括实现资源共享，实现数据信息的快速传递。

    ![](./img/1.jpg)


#### 1.1.2 网络通信标准

* 面临问题

    1. 不同的国家和公司都建立自己的通信标准不利于网络互连
    2. 多种标准并行情况下不利于技术的发展融合

    ![](./img/4.jpg)



* 网络结构体系

    随着网络的不断普及，网络通信体系结构模型也被指定出来。

    网络采用分而治之的方法设计，将网络的功能划分为不同的模块，以分层的形式有机组合在一起。每层实现不同的功能，其内部实现方法对外部其他层次来说是透明的。每层向上层提供服务，同时使用下层提供的服务。网络体系结构即指网络的层次结构和每层所使用协议的集合。其中非常重要的体系结构就是OSI模型。

* OSI 7层模型
    * 开放系统互连参考模型 (Open System Interconnect 简称OSI）是国际标准化组织(ISO)和国际电报电话咨询委员会(CCITT)联合制定的开放系统互连参考模型，为开放式互连信息系统提供了一种功能结构的框架。它从低到高(自底向上)分别是：物理层、数据链路层、网络层、传输层、会话层、表示层和应用层。

    * `OSI`参考模型是计算机网路体系结构发展的产物。它的基本内容是开放系统通信功能的分层结构。每一层的功能是独立的。它利用其下一层提供的服务并为其上一层提供服务，而与其他层的具体实现无关。通常把1～4层协议称为下层协议，5～7层协议称为上层协议。

<img src="./img/5.png" >

* 好处

    1. 建立了统一的通信标准

    2. 降低开发难度，每层功能明确，各司其职

    3. 七层模型实际规定了每一层的任务，该完成什么事情

* TCP/IP模型

    ISO制定的OSI参考模型是理想化的模型，但是它过于庞大、复杂招致了许多批评。与此对照，由技术人员自己开发的TCP/IP协议栈获得了更为广泛的应用。因此现在TCP/IP协议已经称为Internet事实上的工业标准。并衍生出了TCP/IP模型指导实际的开发工作。

    ![](./img/6.jpg)

    ​       

* 网络协议


    * 什么是网络协议：
    * 网络协议是通信计算机双方必须共同遵从的一组约定。如怎么样建立连接、怎么样互相识别等。只有遵守这个约定，计算机之间才能相互通信交流。它的三要素是：语法、语义、时序
    * 网络协议实际上规定了每一层在完成自己的任务时应该遵循什么规范。
    * TCP/IP协议，Transmission Control Protocol/Internet Protocol的简写，中译名为传输控制协议/因特网互联协议，是Internet最基本的协议、Internet国际互联网络的基础，由网络层的IP协议和传输层的TCP协议组成。TCP/IP 定义了电子设备如何连入因特网，以及数据如何在它们之间传输的标准。实际上我们现在所说的TCP/IP 协议有时想表达的是tcp/ip协议簇，这是一组常用的协议。

* 网络模型各层协议

    在网络模型中每一层都有若干协议。如果说网络模型是知道每一次要干什么，那么协议则细化了每一次功能的具体实施方针。

    ![](./img/网络模型各层协议.png)

#### 1.1.3 常用协议：


* IP协议

    即互联网协议(Internet Protocol)，它将多个网络连成一个互联网，可以把高层的数据以多个数据包的形式通过互联网分发出去。IP的基本任务是通过互联网传送数据包，各个IP数据包之间是相互独立的。

-   TCP协议

    即传输控制协议，它提供的是一种可靠的数据流服务。当传送受差错干扰的数据，或举出网络故障，或网络负荷太重而使网际基本传输系统不能正常工作时，就需要通过其他的协议来保证通信的可靠。

-   UDP协议

    即用户数据包协议，它是对IP协议组的扩充，它增加了一种机制，发送方可以区分一台计算机上的多个接收者。每个UDP报文除了包含数据外还有报文的目的端口的编号和报文源端口的编号，从而使UDP软件可以把报文递送给正确的接收者，然后接收者要发出一个应答。

-   FTP协议

    即文件传输协议，它是网际提供的用于访问远程机器的协议，它使用户可以在本地机与远程机之间进行有关文件的操作。FTP工作时建立两条TCP链接，分别用于传送文件和用于传送控制。

-   DNS协议

    即域名服务协议，它提供域名到IP地址的转换，允许对域名资源进行分散管理。DNS最初设计的目的是使邮件发送方知道邮件接收主机及邮件发送主机的IP地址，后来发展成可服务于其他许多目标的协议。

-   HTTP协议


    超文本传输协议（HTTP，HyperText Transfer Protocol)是互联网上应用最为广泛的一种网络协议。所有的WWW文件都必须遵守这个标准。设计HTTP最初的目的是为了提供一种发布和接收HTML页面的方法。

#### 1.1.3  网络基础概念


* IP地址

    * IP地址 ： 即在网络中标识一台计算机的地址编号。

    * IP地址分类

        * IPv4 ： 192.168.1.5 
        * IPv6 ：fe80::80a:76cf:ab11:2d73

    * IPv4 特点

        * 分为4个部分，每部分是一个整数，取值分为0-255

    * IPv6 特点（了解）

        * 分为8个部分，每部分4个16进制数，如果出现连续的数字 0 则可以用 ：：省略中间的0

    * IP地址相关命令

        * ifconfig : 查看Linux系统下计算机的IP地址

            ![](./img/7.png)

        * ping  [ip]：查看计算机的连通性 

            ![](./img/8.png)

    * 公网IP和内网IP

        * 公网IP指的是连接到互联网上的公共IP地址，大家都可以访问。（将来进公司，公司会申请公网IP作为网络项目的被访问地址）
        * 内网IP指的是一个局域网络范围内由网络设备分配的IP地址。

* 域名

    
* 网域名称系统（DNS，Domain Name System，将域名和IP地址相互映射的一个分布式数据库）是因特网的一项核心服务，它作为可以将域名和IP地址相互映射的一个记录集合，能够使人更方便地访问互联网，而不用去记住能够被机器直接读取的IP地址数串。
    
* 端口号

    * 端口：网络地址的一部分，在一台计算机上，每个网络程序对应一个端口。

        ![](./img/3.png)

    * 端口号特点
    
        * 取值范围： 0 —— 65535 的整数
        * 一台计算机上的网络应用所使用的端口不会重复
        * 通常 0——1023 的端口会被一些有名的程序或者系统服务占用，个人一般使用 > 1024的端口

#### 1.1.4 服务端与客户端

* 服务端（Server）：服务端是为客户端服务的，服务的内容诸如向客户端提供资源，保存客户端数据，处理客户端请求等。

* 客户端（Client） ：也称为用户端，是指与服务端相对应，为客户提供一定应用功能的程序，我们平时使用的手机或者电脑上的程序基本都是客户端程序。

    ![](./img/10.jpg)



## 2. TCP 和 UDP


### 2.1 数据传输过程

![](./img/数据传输过程.png)

### 2.2 面向连接 - TCP传输

面向连接的通讯方式提供了顺序的，可靠的，不会重复的数据传输，而且也不会被加上数据边界。这也意味着，每一个要发送的信息，可能会被拆分成多份，每一份都会不多不少地正确到达目的地。然后被重新按顺序拼装起来，传给正在等待的应用程序。实现这种连接的主要协议就是传输控制协议（即 TCP） 。

#### 2.2.1 TCP传输特点 (面向连接的传输服务)

* 传输特征 ： 提供了可靠的数据传输，可靠性指数据传输过程中无丢失，无失序，无差错，无重复。
* 可靠性保障机制（都是操作系统网络服务自动帮应用完成的）： 
    * 在通信前需要建立数据连接
    * 确认应答机制
    * 通信结束要正常断开连接

-   tcp 传输首部

    ![](./img/1_tcp数据包.png)

* 三次握手（建立连接）

    >   在TCP/IP协议中，TCP协议提供可靠的连接服务，采用三次握手建立一个连接。服务器必须准备好接受外来的连接。这通过调用socket、 bind和listen函数来完成，称为被动打开(passive open)。
    >
    >   -   第一次握手：客户通过调用connect进行主动打开(active open)。这引起客户TCP发送一个SYN（表示同步）分节（SYN=J），它告诉服务器客户将在连接中发送到数据的初始序列号。并进入SYN_SEND状态，等待服务器的确认。
    >   -   第二次握手：服务器必须确认客户的SYN，同时自己也得发送一个SYN分节，它含有服务器将在同一连接中发送的数据的初始序列号。服务器以单个字节向客户发送SYN和对客户SYN的ACK（表示确认），此时服务器进入SYN_RECV状态。
    >   -   第三次握手：客户收到服务器的SYN+ACK。向服务器发送确认分节，此分节发送完毕，客户服务器进入ESTABLISHED状态，完成三次握手。

    * 客户端向服务器发送消息报文请求连接
    * 服务器收到请求后，回复报文确定可以连接
    * 客户端收到回复，发送最终报文连接建立

![](./img/1_三次握手.png)
					

* 四次挥手（断开连接）

    >   -   第一次挥手：某个应用进程首先调用close，我们称这一端执行主动关闭。这一端的TCP于是发送一个FIN分节，表示数据发送完毕。
    >
    >   -   第二次挥手：接收到FIN的另一端执行被动关闭（passive close）。这个FIN由TCP确认。它的接收也作为文件结束符传递给接收端应用进程（放在已排队等候应用进程接收到任何其他数据之后）
    >
    >   -   第三次挥手：一段时间后，接收到文件结束符的应用进程将调用close关闭它的套接口。这导致它的TCP也发送一个FIN。
    >   -   第四次挥手：接收到这个FIN的原发送端TCP对它进行确认。

    * 主动方发送报文请求断开连接
    * 被动方收到请求后，立即回复，表示准备断开
    * 被动方准备就绪，再次发送报文表示可以断开
    * 主动方收到确定，发送最终报文完成断开

![](./img/1_四次挥手.png)

### 2.3 **面向无连接的传输**

-   UDP（User Datagram Protocol）用户数据报协议，是不可靠的无连接的协议。在数据发送前，因为不需要进行连接，所以可以进行高效率的数据传输。

-   适用情况：发送小尺寸数据（如对DNS服务器进行IP地址查询时）在接收到数据，给出应答较困难的网络中使用UDP。（如：无线网络）适合于广播/组播式通信中。MSN/QQ/Skype等即时通讯软件的点对点文本通讯以及音视频通讯通常采用UDP协议。流媒体、VOD、VoIP、IPTV等网络多媒体服务中通常采用UDP方式进行实时数据传输。

![](./img/9.jpg)